#!/bin/sh

# Pro-grade Pre-commit Hook
# 1. Formats code (Go & Biome)
# 2. Re-stages fixed files
# 3. Validates with linter

echo "ğŸš€ Running pre-commit quality checks..."

# --- 1. Backend Formatting ---
echo "ğŸ¨ Formatting Go code..."
make fmt
if [ $? -ne 0 ]; then
    echo "âŒ Go formatting failed."
    exit 1
fi
# Re-stage any Go files modified by fmt
git add backend/*.go backend/**/*.go

# --- 2. Frontend Formatting ---
echo "ğŸ¨ Formatting frontend code (Biome)..."
make fmt-frontend
if [ $? -ne 0 ]; then
    echo "âŒ Frontend formatting failed."
    exit 1
fi
# Re-stage any frontend files modified by Biome
git add frontend/src

# --- 3. Backend Linting ---
echo "ğŸ” Linting backend code..."
make lint
if [ $? -ne 0 ]; then
    echo "âŒ Backend linting failed. Please fix errors before committing."
    exit 1
fi

# --- 4. Frontend Linting ---
echo "ğŸ” Linting frontend code..."
make lint-frontend
if [ $? -ne 0 ]; then
    echo "âŒ Frontend linting failed. Please fix errors before committing."
    exit 1
fi

echo "âœ… All checks passed! Proceeding with commit."
exit 0
