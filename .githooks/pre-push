#!/bin/sh
set -e

# Pre-push hook: ensure frontend lockfile is in sync with package.json
# This prevents pushes that would pass local non-frozen installs but fail CI.

if [ -d frontend ]; then
  if command -v bun >/dev/null 2>&1; then
	echo "Checking frontend lockfile with 'bun install --frozen-lockfile'..."
	cd frontend
	if ! bun install --frozen-lockfile >/dev/null 2>&1; then
	  printf "\nERROR: frontend lockfile is out of sync with package.json.\n"
	  printf "Run 'cd frontend && bun install' and commit the updated lockfile, or fix package.json.\n"
	  exit 1
	fi
	cd - >/dev/null 2>&1 || true
  else
	echo "bun not found; skipping frontend lockfile check"
  fi
fi

exit 0
